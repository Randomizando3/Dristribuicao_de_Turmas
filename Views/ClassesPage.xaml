<UserControl x:Class="DistribuicaoTurmas.Views.ClassesPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <!-- ======= Recursos locais (apenas para esta tela) ======= -->
    <UserControl.Resources>
        <!-- Paleta -->
        <SolidColorBrush x:Key="HeaderBg"        Color="#F5F7FA"/>
        <SolidColorBrush x:Key="HeaderFg"        Color="#1F2937"/>
        <SolidColorBrush x:Key="RowBg"           Color="#FFFFFFFF"/>
        <SolidColorBrush x:Key="AltRowBg"        Color="#FFF7F9FC"/>
        <SolidColorBrush x:Key="GridLine"        Color="#D9E1EC"/>
        <SolidColorBrush x:Key="SelectionBg"     Color="#E0F2FE"/>
        <SolidColorBrush x:Key="SelectionBorder" Color="#93C5FD"/>

        <!-- ===== Cabeçalho com: separadores, gripper e ícone de ordenação ===== -->
        <Style x:Key="ModernHeader" TargetType="{x:Type DataGridColumnHeader}">
            <Setter Property="Background" Value="{StaticResource HeaderBg}"/>
            <Setter Property="Foreground" Value="{StaticResource HeaderFg}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="Padding" Value="8,0,18,0"/>
            <!-- espaço à direita p/ ícones/gripper -->
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="BorderBrush" Value="{StaticResource GridLine}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type DataGridColumnHeader}">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <Grid>
                                <!-- Colunas: conteúdo | ícone ordenação | separador | gripper -->
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition/>
                                    <ColumnDefinition Width="20"/>
                                    <!-- ícone sort -->
                                    <ColumnDefinition Width="1"/>
                                    <!-- linha divisória visual -->
                                    <ColumnDefinition Width="8"/>
                                    <!-- área do gripper -->
                                </Grid.ColumnDefinitions>

                                <!-- Conteúdo do header -->
                                <ContentPresenter Grid.Column="0"
                                                  HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                  VerticalAlignment="Center"
                                                  Margin="{TemplateBinding Padding}"/>

                                <!-- Ícones de ordenação (aparecem apenas quando ordenado) -->
                                <Grid Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <!-- Asc -->
                                    <Path x:Name="AscPath"
                                          Stroke="#64748B" StrokeThickness="1.4"
                                          Data="M 2 10 L 6 6 L 10 10"
                                          Stretch="Uniform" Width="12" Height="12"
                                          Visibility="Collapsed"/>
                                    <!-- Desc -->
                                    <Path x:Name="DescPath"
                                          Stroke="#64748B" StrokeThickness="1.4"
                                          Data="M 2 6 L 6 10 L 10 6"
                                          Stretch="Uniform" Width="12" Height="12"
                                          Visibility="Collapsed"/>
                                </Grid>

                                <!-- Divisória visual entre headers -->
                                <Border Grid.Column="2"
                                        Background="{StaticResource GridLine}"
                                        Width="1" Margin="0,8,0,8"/>

                                <!-- Gripper real para redimensionar (precisa deste nome!) -->
                                <Thumb x:Name="PART_RightHeaderGripper"
                                       Grid.Column="3"
                                       Cursor="SizeWE"
                                       HorizontalAlignment="Stretch"
                                       Background="Transparent"/>
                            </Grid>
                        </Border>

                        <!-- Triggers: hover/press e ícones sort -->
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#F0F5FA"/>
                            </Trigger>
                            <Trigger Property="SortDirection" Value="Ascending">
                                <Setter TargetName="AscPath" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="DescPath" Property="Visibility" Value="Collapsed"/>
                            </Trigger>
                            <Trigger Property="SortDirection" Value="Descending">
                                <Setter TargetName="AscPath" Property="Visibility" Value="Collapsed"/>
                                <Setter TargetName="DescPath" Property="Visibility" Value="Visible"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Células centralizadas com hover/seleção agradáveis -->
        <Style x:Key="CenteredCell" TargetType="DataGridCell">
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="Padding" Value="8,0"/>
            <Setter Property="BorderBrush" Value="{StaticResource GridLine}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Background" Value="{x:Null}"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource SelectionBg}"/>
                    <Setter Property="BorderBrush" Value="{StaticResource SelectionBorder}"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F2F8FF"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- TextBlock central -->
        <Style x:Key="CenteredTextBlock" TargetType="TextBlock">
            <Setter Property="TextAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- TextBox central (edição) -->
        <Style x:Key="CenteredTextBox" TargetType="TextBox">
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="TextAlignment" Value="Center"/>
            <Setter Property="Padding" Value="6,2"/>
        </Style>

        <!-- ComboBox com setinha sempre visível -->
        <Style x:Key="GridCombo" TargetType="ComboBox">
            <Setter Property="MinWidth" Value="120"/>
            <Setter Property="Padding" Value="6,2"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="IsEditable" Value="False"/>
        </Style>
    </UserControl.Resources>

    <DockPanel LastChildFill="True">

        <!-- Título + ações -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,12">
            <TextBlock Text="Edição de Turmas" Style="{StaticResource H1}" Margin="0,0,12,0"/>
            <Button Content="Adicionar Turma" Command="{Binding AddClassCommand}" />
            <Button Content="Remover Selecionada" Command="{Binding RemoveSelectedCommand}" Margin="8,0,0,0"/>
        </StackPanel>

        <!-- ======= DataGrid ======= -->
        <DataGrid ItemsSource="{Binding Classes}"
                  SelectedItem="{Binding SelectedClass}"
                  AutoGenerateColumns="False"
                  IsReadOnly="False"

                  HeadersVisibility="Column"
                  ColumnHeaderStyle="{StaticResource ModernHeader}"
                  CellStyle="{StaticResource CenteredCell}"

                  GridLinesVisibility="All"
                  HorizontalGridLinesBrush="{StaticResource GridLine}"
                  VerticalGridLinesBrush="{StaticResource GridLine}"

                  RowHeaderWidth="0"
                  RowHeight="36"
                  ColumnHeaderHeight="38"
                  AlternationCount="2"
                  RowBackground="{StaticResource RowBg}"
                  AlternatingRowBackground="{StaticResource AltRowBg}"

                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  CanUserResizeRows="False"
                  CanUserReorderColumns="True"
                  CanUserResizeColumns="True"
                  CanUserSortColumns="True"

                  SelectionMode="Single"
                  SelectionUnit="FullRow"
                  SnapsToDevicePixels="True"
                  BorderThickness="1"
                  BorderBrush="{StaticResource GridLine}">

            <DataGrid.Columns>

                <!-- Disciplina -->
                <DataGridTextColumn Header="Disciplina"
                                    Binding="{Binding Name}"
                                    SortMemberPath="Name"
                                    Width="2*">
                    <DataGridTextColumn.ElementStyle>
                        <Style BasedOn="{StaticResource CenteredTextBlock}" TargetType="TextBlock"/>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.EditingElementStyle>
                        <Style BasedOn="{StaticResource CenteredTextBox}" TargetType="TextBox"/>
                    </DataGridTextColumn.EditingElementStyle>
                </DataGridTextColumn>

                <!-- Inscritos -->
                <DataGridTextColumn Header="Inscritos"
                                    Binding="{Binding Enrolled}"
                                    SortMemberPath="Enrolled"
                                    Width="110">
                    <DataGridTextColumn.ElementStyle>
                        <Style BasedOn="{StaticResource CenteredTextBlock}" TargetType="TextBlock"/>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.EditingElementStyle>
                        <Style BasedOn="{StaticResource CenteredTextBox}" TargetType="TextBox"/>
                    </DataGridTextColumn.EditingElementStyle>
                </DataGridTextColumn>

                <!-- Professor -->
                <DataGridTextColumn Header="Professor"
                                    Binding="{Binding Teacher}"
                                    SortMemberPath="Teacher"
                                    Width="170">
                    <DataGridTextColumn.ElementStyle>
                        <Style BasedOn="{StaticResource CenteredTextBlock}" TargetType="TextBlock"/>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.EditingElementStyle>
                        <Style BasedOn="{StaticResource CenteredTextBox}" TargetType="TextBox"/>
                    </DataGridTextColumn.EditingElementStyle>
                </DataGridTextColumn>

                <!-- Necessita Computadores (S/N) -->
                <DataGridComboBoxColumn Header="Necessita Comp. (S/N)"
                                        SelectedItemBinding="{Binding NeedsComputersDisplay, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        SortMemberPath="NeedsComputersDisplay"
                                        Width="150">
                    <DataGridComboBoxColumn.ElementStyle>
                        <Style BasedOn="{StaticResource GridCombo}" TargetType="ComboBox">
                            <Setter Property="ItemsSource"
                                    Value="{Binding DataContext.SNOptions, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                            <Setter Property="IsHitTestVisible" Value="True"/>
                            <Setter Property="Focusable" Value="True"/>
                        </Style>
                    </DataGridComboBoxColumn.ElementStyle>
                    <DataGridComboBoxColumn.EditingElementStyle>
                        <Style BasedOn="{StaticResource GridCombo}" TargetType="ComboBox">
                            <Setter Property="ItemsSource"
                                    Value="{Binding DataContext.SNOptions, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                        </Style>
                    </DataGridComboBoxColumn.EditingElementStyle>
                </DataGridComboBoxColumn>

                <!-- Horário 1 -->
                <DataGridComboBoxColumn Header="Horário 1"
                                        SelectedItemBinding="{Binding Slot1, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        SortMemberPath="Slot1"
                                        Width="170">
                    <DataGridComboBoxColumn.ElementStyle>
                        <Style BasedOn="{StaticResource GridCombo}" TargetType="ComboBox">
                            <Setter Property="ItemsSource"
                                    Value="{Binding DataContext.AllSlots, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                            <Setter Property="IsHitTestVisible" Value="True"/>
                            <Setter Property="Focusable" Value="True"/>
                        </Style>
                    </DataGridComboBoxColumn.ElementStyle>
                    <DataGridComboBoxColumn.EditingElementStyle>
                        <Style BasedOn="{StaticResource GridCombo}" TargetType="ComboBox">
                            <Setter Property="ItemsSource"
                                    Value="{Binding DataContext.AllSlots, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                        </Style>
                    </DataGridComboBoxColumn.EditingElementStyle>
                </DataGridComboBoxColumn>

                <!-- Horário 2 (opcional) -->
                <DataGridComboBoxColumn Header="Horário 2 (opcional)"
                                        SelectedItemBinding="{Binding Slot2, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        SortMemberPath="Slot2"
                                        Width="190">
                    <DataGridComboBoxColumn.ElementStyle>
                        <Style BasedOn="{StaticResource GridCombo}" TargetType="ComboBox">
                            <Setter Property="ItemsSource"
                                    Value="{Binding DataContext.AllSlots, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                            <Setter Property="IsHitTestVisible" Value="True"/>
                            <Setter Property="Focusable" Value="True"/>
                        </Style>
                    </DataGridComboBoxColumn.ElementStyle>
                    <DataGridComboBoxColumn.EditingElementStyle>
                        <Style BasedOn="{StaticResource GridCombo}" TargetType="ComboBox">
                            <Setter Property="ItemsSource"
                                    Value="{Binding DataContext.AllSlots, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                        </Style>
                    </DataGridComboBoxColumn.EditingElementStyle>
                </DataGridComboBoxColumn>

            </DataGrid.Columns>
        </DataGrid>
    </DockPanel>
</UserControl>
